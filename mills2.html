<!DOCTYPE html>

<html>

<head>
   <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css" />
   <style>
     body {
      padding: 0;
      margin: 0;
      }
     html, body, #mapid {
       height: 100%;
       width: 100%;
     }
   </style>
</head>

<body>
   
     <!-- JS -->
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
     <script src="https://unpkg.com/leaflet@1.0.1/dist/leaflet.js"></script>
     <script src="segs.geojson"></script>
     <script src="https://unpkg.com/esri-leaflet@2.0.4"></script>
     <script src="https://rawgithub.com/mylen/leaflet.TileLayer.WMTS/master/leaflet-tilelayer-wmts.js"></script>
  <div id="mapid"></div>

  <script>

    /* BASEMAPS */
    var mymap = L.map('mapid').setView([34.60571370411983, -92.48319983482362], 17);
     
    var imagery = L.esri.basemapLayer('Imagery').addTo(mymap);
    var imageryLabels = L.esri.basemapLayer('ImageryLabels').addTo(mymap);
    var dem = L.esri.dynamicMapLayer({url: "https://www.efsedge.com/arcgis/rest/services/Saline_County/Saline_DEM/MapServer"});

    var Stamen_TonerLite = L.tileLayer('http://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.{ext}', {
      attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
      subdomains: 'abcd',
      minZoom: 0,
      maxZoom: 20,
      ext: 'png'
    });

         
     /*Building Footprints*/
     var building_footprints = L.esri.featureLayer({
      onEachFeature: function (feature, layer)
      {
        layer.bindPopup("Parcel ID: " + feature.properties.parcel_id)
      },
      url: 'https://www.efsedge.com/arcgis/rest/services/Saline_County/Vector2/MapServer/21',
      style: {
        color: '#F2F3F4',
        weight: 2
      }
    });

    /* Contours */
    var contoursLayer = L.geoJson(null);
    var contours = L.geoJson(null, {
      style: function (feature){
        if (feature.properties.LAYER == "INT"){
          return {
            color: '#8DB600',
            weight: '1.0',
          }
        }
        if (feature.properties.LAYER == "MJR"){
          return {
            color: '#008856',
            weight: '1.5',
          }
        }
      }
    });
    $.getJSON("contours.geojson", function (data){
      contours.addData(data);
    });

    /*Existing Trails Outline*/
    var trails_outlineLayer = L.geoJson(null);
    var trails_outline = L.geoJson(null, {
      style: function (feature){
        return {
          color: "#222222",
          weight:"5",
        }
      }
    });
    $.getJSON("mills_trails.geojson", function (data){
      trails_outline.addData(data);
    });
    trails_outline.addTo(mymap);
    trails_outline.bringToFront();

    /*Existing Trails*/
    var trailsLayer = L.geoJson(null);
    var trails = L.geoJson(null, {
      style: function (feature){
        return {
          color: "#848482",
          weight:"2.5",
        }
      }
    });
    $.getJSON("mills_trails.geojson", function (data){
      trails.addData(data);
    });
    trails.addTo(mymap);
    trails.bringToFront();

    /* Parcels */
    var parcelsLayer = L.geoJson(null);
    var parcels = L.geoJson(null, {
      
      style: function (feature) {
        return {
          weight: 1,
          opacity: 1,
          color: '#F3C300',
          fillColor: 'black',
          fillOpacity: 0.2
        };
      },
      onEachFeature: function (feature, layer) {
        if (feature.properties) {
          var parcelsContent = "<table class='table table-striped table-bordered table-condensed'>" + 
            "<tr><th>Owner Name</th><td>" + feature.properties.ow_name + "</td></tr>" 
            + "<tr><th>Owner Source Date</th><td>" + feature.properties.ow_src_dat + "</td></tr>" 
            + "<tr><th>Parcel ID</th><td>" + feature.properties.parcel_id + "</td></tr>" 
            + "<table>";
          layer.on({
            click: function (e) {
              layer.bindPopup(parcelsContent);
            }
          });
        }
        layer.on({
          mouseover: function (e) {
            var layer = e.target;
            layer.setStyle({
              weight: 2,
              fillOpacity: 0.5,
              dashArray: '10, 5'
            });
          },
          mouseout: function (e) {
            parcels.resetStyle(e.target);
          }
        });    
      }
    });
    
    $.getJSON("parcels.geojson", function (data) {
      parcels.addData(data);
      parcels.setZ
    });

    /*Segments Outline*/
    var segments_outlineLayer = L.geoJson(null);
    var segments_outline = L.geoJson(null, {
      style: function (feature){
        return {
          color: "#222222",
          weight:"5.0",
        }
      }
    });
    $.getJSON("segs.geojson", function (data){
      segments_outline.addData(data);
    });
    segments_outline.addTo(mymap);
    segments_outline.bringToFront();

    /* Segments */
    var segmentsLayer = L.geoJson(null);
    var segments = L.geoJson(null, {
      style: function (feature){
        if (feature.properties.NAME == 1){
          return {
            color: '#DCD300',
            weight: '2.5',
          }
        }
        if (feature.properties.NAME == 2){
          return {
            color: '#E68FAC',
            weight: '2.5',
          }
        }
        if (feature.properties.NAME == 3){
          return {
            color: '#F38400',
            weight: '2.5',
          }
        }
        if (feature.properties.NAME == 4){
          return {
            color: '#A1CAF1',
            weight: '2.5',
          }
        }
        if (feature.properties.NAME == 5){
          return {
            color: '#F2F3F4',
            weight: '2.5',
          }
        }
        if (feature.properties.NAME == 6){
          return {
            color: '#BE0032',
            weight: '2.5',
          }
        }
      }
    });
    $.getJSON("segs.geojson", function (data){
      segments.addData(data);
    });
    segments.addTo(mymap);
    segments.bringToFront();

    /*Elevation overlay*/   
    var imageUrl = "saline2.png",
        imageBounds = [[34.618709020731, -92.50478665723], [34.592881718430, -92.46680533031]];
      
    var elevation = L.imageOverlay(imageUrl, imageBounds);
     
    
    /*Layer Control*/ 
    var baseMaps = {
      "Imagery": imagery,
      "Saline County Lidar": dem,
      "Toner": Stamen_TonerLite
    };
    var overlayMaps = {
      "Buildings": building_footprints,
      "Contours": contours,
      "Parcels": parcels,
      "Elevation": elevation
    };
    L.control.layers(baseMaps, overlayMaps, {
      collapsed: false
    }).addTo(mymap);

    mymap.on("overlayadd", function (event) {
      trails_outline.bringToFront();
    });
    mymap.on("overlayadd", function (event) {
      trails.bringToFront();
    });
    mymap.on("overlayadd", function (event) {
      segments_outline.bringToFront();
    });
    mymap.on("overlayadd", function (event) {
      segments.bringToFront();
    });
      
  </script>
   
</body>
</html>
