<!DOCTYPE html>

<html>

<head>
   <style>
     body {
      padding: 0;
      margin: 0;
      }
     html, body, #mapid {
       height: 100%;
       width: 100%;
     }
   </style>
</head>

<body>
   
     <!-- JS -->
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
       <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
      <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet-src.js"></script>
     <script src="segs.geojson"></script>
     <script src="https://unpkg.com/esri-leaflet@2.0.7"></script>
     <script src="https://rawgithub.com/mylen/leaflet.TileLayer.WMTS/master/leaflet-tilelayer-wmts.js"></script>
<!-- Include Leaflet.markercluster via rawgit.com
in production you'd be better off hosting these libraries yourself -->
<link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/Leaflet/Leaflet.markercluster/v1.0.0-beta.2.0/dist/MarkerCluster.Default.css">
<link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/Leaflet/Leaflet.markercluster/v1.0.0-beta.2.0/dist/MarkerCluster.css">
<script src="https://cdn.rawgit.com/Leaflet/Leaflet.markercluster/v1.0.0-beta.2.0/dist/leaflet.markercluster.js"></script>

<!-- Load Clustered Feature Layer from CDN -->
<script src="https://unpkg.com/esri-leaflet-cluster@2.0.0"></script>


  <div id="mapid"></div>

  <script>

    /* BASEMAPS */
    var mymap = L.map('mapid').setView([34.60571370411983, -92.48319983482362], 17);
     
    var imagery = L.esri.basemapLayer('Imagery').addTo(mymap);
    var imageryLabels = L.esri.basemapLayer('ImageryLabels').addTo(mymap);
    var dem = L.esri.dynamicMapLayer({url: "https://www.efsedge.com/arcgis/rest/services/Saline_County/Saline_DEM/MapServer"});

    var Stamen_TonerLite = L.tileLayer('http://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.{ext}', {
      attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
      subdomains: 'abcd',
      minZoom: 0,
      maxZoom: 20,
      ext: 'png'
    });

         

  /* Permits */

var permits = L.esri.Cluster.featureLayer({
  url: 'https://gis.adeq.state.ar.us/arcgis/rest/services/EnviroView_Data/MapServer/0',
  style: {
    color: '#F38400'
  }
})

permits.bindPopup(function(feature){
  return L.Util.template('<strong>{entity_name}</strong><br>', feature.properties.PmtAFIN);
});

    var marker_red = L.icon({
        iconUrl: 'marker-red.png',
        //shadowUrl: 'leaf-shadow.png',
        iconSize:     [32, 32] // size of the icon
    });

    /* NPDES */
    var permits2 = L.esri.featureLayer({
      onEachFeature: function (feature, layer)
      {
        layer.bindPopup(feature.properties.FacName + '<br>'+ feature.properties.PmtAFIN + '<br>' + feature.properties.MediaDesc + '<br>' + feature.properties.PmtNbr)
      },
      url: 'https://gis.adeq.state.ar.us/arcgis/rest/services/EnviroView_Data/MapServer/0',
      style: function (feature){
        if (feature.properties.MediaDesc == "Water-NPDES"){
          return {
            icon: 'marker_red',
          }
        }
        if (feature.properties.MediaDesc== "RST"){
          return {
            color: '#2EFE2E',
          }
        }
      }
    });
   
    
    /*Layer Control*/ 
    var baseMaps = {
      "Imagery": imagery,
      "Saline County Lidar": dem,
      "Toner": Stamen_TonerLite
    };
    var overlayMaps = {
      "Permits": permits,
      "Permits 2": permits2

    };
    L.control.layers(baseMaps, overlayMaps, {
      collapsed: false
    }).addTo(mymap);
     
  </script>
   
</body>
</html>
